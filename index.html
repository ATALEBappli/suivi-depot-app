<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Suivi Depot</title>

  <!-- Anti-cache léger pour Safari -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>📊 Suivi Depot</h1>
  </header>

  <main>
    <!-- Onglets -->
    <div class="tabs">
      <button class="tablink active" onclick="openTab('synthese', this)" data-tab="synthese">📊 Synthèse</button>
      <button class="tablink"        onclick="openTab('saisie', this)"    data-tab="saisie">✍️ Saisie</button>
      <button class="tablink" onclick="openTab('param', this)" data-tab="param">⚙️ Paramétrage</button>
    </div>

    <!-- Onglet Synthèse -->
    <section id="synthese" class="tabcontent">
      <div id="kpis" style="margin:20px 0; font-size:18px; font-weight:bold;">Chargement…</div>

      <label>Mois
        <select id="mois"></select>
      </label>

      <label>Type
        <select id="type">
          <option value="">(Tous)</option>
          <option>Entrée</option>
          <option>Sortie</option>
        </select>
      </label>

      <table id="table">
        <thead>
          <tr>
            <th>Date</th><th>Type</th><th>Sous-bloc</th><th>Montant</th><th>Description</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

<!-- Onglet Saisie -->
<section id="saisie" class="tabcontent" style="display:none">
  <h2>✍️ Nouvelle opération</h2>

  <form id="saisieForm">
    <label>Type
      <select id="form_type">
        <option>Entrée</option>
        <option>Sortie</option>
      </select>
    </label><br>

          <label>Sous-bloc
  <select id="form_sous_bloc"></select>
</label>
<div id="other_wrap" style="display:none; margin:6px 0 10px 0;">
  <input id="form_sous_bloc_other" type="text" placeholder="Saisir un autre sous-bloc…" />
</div>
    
   
<div id="app-extra" style="display:none; padding:10px; margin:10px 0; border:1px dashed #ccc; border-radius:8px;">
  <strong>Appartement</strong>
  <div style="display:grid; gap:8px; grid-template-columns: 1fr 1fr;">
    <label>Numéro
      <select id="form_app_num"></select>
    </label>
    <label>Type (F2/F3/F4…)
      <input id="app-type" type="text" placeholder="ex: F3" />
    </label>
    <label>Locataire
      <input id="form_locataire" type="text" placeholder="Nom du locataire" />
    </label>
  </div>
  <p class="muted" style="margin:6px 0 0">👉 Le montant et la date sont aussi pré-remplis automatiquement (mais modifiables).</p>
</div>


<!-- puis ton <label>Date> existant -->


    <label>Date
      <input id="form_date" type="date" />
    </label><br>

    <label>Montant
      <input id="form_montant" type="number" step="0.01" />
    </label><br>

    <label>Description
      <input id="form_description" type="text" placeholder="ex: Facture T1, Paie Août…" />
    </label><br>

    <button type="submit">💾 Enregistrer</button>
  </form>
</section>
<section id="param" class="tabcontent" style="display:none">
  <h2>⚙️ Paramétrage</h2>

  <!-- Bloc 1 : Appartements -->
  <article class="card">
    <h3>🏢 Appartements</h3>
    <p class="muted">Gère ici la liste des appartements (Num, Type, Locataire, Loyer). Ces données servent au pré-remplissage dans <em>Saisie</em> quand tu choisis Entrée → APP.</p>

    <div style="margin:8px 0">
      <button id="cfg-log-add">➕ Ajouter un appartement</button>
      <button id="cfg-log-save">💾 Sauvegarder</button>
      <span id="cfg-log-msg" class="muted"></span>
    </div>

    <div class="table-wrap">
      <table id="cfg-log-table">
        <thead>
          <tr>
            <th>Num</th><th>Type (F2/F3/F4…)</th><th>Locataire</th><th>Loyer (€)</th><th></th>
          </tr>
        </thead>
        <tbody><!-- rempli par JS --></tbody>
      </table>
    </div>
  </article>

  <!-- 🔜 Blocs à venir : Locaux, Impôts, etc. -->
  <!-- <article class="card"><h3>🏬 Locaux</h3> … </article> -->
</section>

    
  </main>

  <script>
    // <<< REMPLACE ICI PAR TON URL APPS SCRIPT >>>
    window.API_URL = "https://script.google.com/macros/s/AKfycbwvVU2pxq88mHWZYBLYe-iK-xF_eSjgzOBPLzIgV0Hr0QzHXI1_F6TqDcbTZh_rNaSYpw/exec";

    // Gestion simple des onglets

  function openTab(id, btn){
    // cacher tout
    document.querySelectorAll('.tabcontent').forEach(s => s.style.display = 'none');
    // afficher le bon
    const el = document.getElementById(id);
    if (el) el.style.display = 'block';

    /* 👉 AJOUTE CETTE LIGNE : recharge la liste selon Entrée/Sortie quand on ouvre "Saisie" */
    if (id === 'saisie' && typeof populateFormSousBloc === 'function') { populateFormSousBloc(); }

    // état visuel
    document.querySelectorAll('.tablink').forEach(b => b.classList.remove('active'));
    if (btn) btn.classList.add('active');
  }
    // Ouvrir Synthèse au chargement
    document.addEventListener('DOMContentLoaded', () => openTab('synthese', document.querySelector('.tablink')));
  </script>

  <script src="app.js?v=5"></script>

  <!-- Service Worker pour PWA -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    }
  </script>
</body>
</html>

















